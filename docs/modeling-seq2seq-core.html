---

title: modeling.seq2seq.core


keywords: fastai
sidebar: home_sidebar

summary: "This module contains core custom models, loss functions, etc... for Seq2Seq based tasks (e.g., language modeling, summarization, translation, etc...)"
description: "This module contains core custom models, loss functions, etc... for Seq2Seq based tasks (e.g., language modeling, summarization, translation, etc...)"
nb_path: "nbs/10_modeling-seq2seq-core.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/10_modeling-seq2seq-core.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>What we&#39;re running with at the time this documentation was generated:
torch: 1.10.1+cu111
fastai: 2.5.3
transformers: 4.16.2
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Seq2Seq">Seq2Seq<a class="anchor-link" href="#Seq2Seq"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;cnn_dailymail&quot;</span><span class="p">,</span> <span class="s2">&quot;3.0.0&quot;</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;train[:1000]&quot;</span><span class="p">)</span>
<span class="n">cnndm_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="n">cnndm_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Reusing dataset cnn_dailymail (/home/wgilliam/.cache/huggingface/datasets/cnn_dailymail/3.0.0/3.0.0/3cb851bf7cf5826e45d49db2863f627cba583cbc32342df7349dfe6c38060234)
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>article</th>
      <th>highlights</th>
      <th>id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>It's official: U.S. President Barack Obama wants lawmakers to weigh in on whether to use military force in Syria. Obama sent a letter to the heads of the House and Senate on Saturday night, hours after announcing that he believes military action against Syrian targets is the right step to take over the alleged use of chemical weapons. The proposed legislation from Obama asks Congress to approve the use of military force "to deter, disrupt, prevent and degrade the potential for future uses of chemical weapons or other weapons of mass destruction." It's a step that is set to turn an internat...</td>
      <td>Syrian official: Obama climbed to the top of the tree, "doesn't know how to get down"\nObama sends a letter to the heads of the House and Senate .\nObama to seek congressional approval on military action against Syria .\nAim is to determine whether CW were used, not by whom, says U.N. spokesman .</td>
      <td>0001d1afc246a7964130f43ae940af6bc6c57f01</td>
    </tr>
    <tr>
      <th>1</th>
      <td>(CNN) -- Usain Bolt rounded off the world championships Sunday by claiming his third gold in Moscow as he anchored Jamaica to victory in the men's 4x100m relay. The fastest man in the world charged clear of United States rival Justin Gatlin as the Jamaican quartet of Nesta Carter, Kemar Bailey-Cole, Nickel Ashmeade and Bolt won in 37.36 seconds. The U.S finished second in 37.56 seconds with Canada taking the bronze after Britain were disqualified for a faulty handover. The 26-year-old Bolt has now collected eight gold medals at world championships, equaling the record held by American trio...</td>
      <td>Usain Bolt wins third gold of world championship .\nAnchors Jamaica to 4x100m relay victory .\nEighth gold at the championships for Bolt .\nJamaica double up in women's 4x100m relay .</td>
      <td>0002095e55fcbd3a2f366d9bf92a95433dc305ef</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pretrained_model_name</span> <span class="o">=</span> <span class="s2">&quot;facebook/bart-large-cnn&quot;</span>
<span class="n">hf_arch</span><span class="p">,</span> <span class="n">hf_config</span><span class="p">,</span> <span class="n">hf_tokenizer</span><span class="p">,</span> <span class="n">hf_model</span> <span class="o">=</span> <span class="n">BLURR</span><span class="o">.</span><span class="n">get_hf_objects</span><span class="p">(</span><span class="n">pretrained_model_name</span><span class="p">,</span> <span class="n">model_cls</span><span class="o">=</span><span class="n">BartForConditionalGeneration</span><span class="p">)</span>
<span class="n">hf_arch</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_config</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_tokenizer</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">hf_model</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(&#39;bart&#39;,
 transformers.models.bart.configuration_bart.BartConfig,
 transformers.models.bart.tokenization_bart_fast.BartTokenizerFast,
 transformers.models.bart.modeling_bart.BartForConditionalGeneration)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">batch_tokenize_tfm</span> <span class="o">=</span> <span class="n">Seq2SeqBatchTokenizeTransform</span><span class="p">(</span><span class="n">hf_arch</span><span class="p">,</span> <span class="n">hf_config</span><span class="p">,</span> <span class="n">hf_tokenizer</span><span class="p">,</span> <span class="n">hf_model</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">max_target_length</span><span class="o">=</span><span class="mi">130</span><span class="p">)</span>
<span class="n">blocks</span> <span class="o">=</span> <span class="p">(</span><span class="n">Seq2SeqTextBlock</span><span class="p">(</span><span class="n">batch_tokenize_tfm</span><span class="o">=</span><span class="n">batch_tokenize_tfm</span><span class="p">),</span> <span class="n">noop</span><span class="p">)</span>

<span class="n">dblock</span> <span class="o">=</span> <span class="n">DataBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">=</span><span class="n">blocks</span><span class="p">,</span> <span class="n">get_x</span><span class="o">=</span><span class="n">ColReader</span><span class="p">(</span><span class="s2">&quot;article&quot;</span><span class="p">),</span> <span class="n">get_y</span><span class="o">=</span><span class="n">ColReader</span><span class="p">(</span><span class="s2">&quot;highlights&quot;</span><span class="p">),</span> <span class="n">splitter</span><span class="o">=</span><span class="n">RandomSplitter</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span> <span class="o">=</span> <span class="n">dblock</span><span class="o">.</span><span class="n">dataloaders</span><span class="p">(</span><span class="n">cnndm_df</span><span class="p">,</span> <span class="n">bs</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">dls</span><span class="o">.</span><span class="n">one_batch</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;input_ids&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(2, torch.Size([2, 256]), torch.Size([2, 67]))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span><span class="o">.</span><span class="n">show_batch</span><span class="p">(</span><span class="n">dataloaders</span><span class="o">=</span><span class="n">dls</span><span class="p">,</span> <span class="n">max_n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>target</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>&lt;s&gt; (CNN) -- When Ji Yeqing awakened, she was already in the recovery room. Chinese authorities had dragged her out of her home and down four flights of stairs, she said, restraining and beating her husband as he tried to come to her aid. They whisked her into a clinic, held her down on a bed and forced her to undergo an abortion. Her offense? Becoming pregnant with a second child, in violation of China's one-child policy. "After the abortion, I felt empty, as if something was scooped out of me," Ji told a congressional panel in September. "My husband and I had been so excited for our new baby. Now suddenly all that hope and joy and excitement disappeared.... I was very depressed and despondent. For a long time, whenever I thought about my lost child, I would cry." As she lay unconscious, she said, an IUD to prevent future pregnancies was inserted. The issue of forced abortions -- and in some cases, forced sterilizations -- in China has seized the spotlight in recent days with news of escaped activist Chen Guangcheng. Chen, a blind, self-taught lawyer, rose to fame in the late 1990s because of his advocacy for what he calls victims&lt;/s&gt;</td>
      <td>China's one-child policy results in forced abortions and sterilizations, activists say.\nWomen tell of emotional and physical consequences from the procedures.\nActivist Chen Guangcheng works to advocate for victims of such practices.</td>
    </tr>
    <tr>
      <th>1</th>
      <td>&lt;s&gt; Editor's note: Peter Bergen, CNN's national security analyst, is a fellow at the New America Foundation, a Washington-based think tank that promotes innovative thought from across the ideological spectrum, and at New York University's Center on Law and Security. He's the author of "The Osama bin Laden I Know: An Oral History of al Qaeda's Leader." Peter Bergen says Osama bin Laden is still alive and still significant eight years after September 11. HELMAND, Afghanistan (CNN) -- Eight years after September 11, the "war on terror" has gone the way of the dodo. And President Obama talks instead about a war against al Qaeda and its allies. What, then, of al Qaeda's enigmatic leader, Osama bin Laden, who has vanished like a wisp of smoke? And does he even matter now? The U.S. government hadn't had a solid lead on al Qaeda's leader since the battle of Tora Bora in winter 2001. Although there are informed hypotheses that today he is in Pakistan's North West Frontier Province on the Afghan border, perhaps in one of the more northerly areas such as Bajaur, these are essentially guesses, not "actionable" intelligence. A longtime American counterterrorism analyst explained to&lt;/s&gt;</td>
      <td>Peter Bergen: Osama bin Laden still inspires al Qaeda.\nHe says 8 years after 9/11, the "war on terror" has failed to capture him.\nHe says law of averages suggests bin Laden will eventually be caught or killed.</td>
    </tr>
  </tbody>
</table></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Training">Training<a class="anchor-link" href="#Training"> </a></h3><p>Here we create a Seq2Seq specific subclass of <a href="/blurr/modeling-core.html#BaseModelCallback"><code>BaseModelCallback</code></a> in order to include custom, Seq2Seq specific, metrics, and also handle the pre-calculated loss during training</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>seq2seq_metrics</p>
<ul>
<li>{'rouge': { 'compute_args': {'return_types': ["rouge1", "rouge2", "rougeL"], 'use_stemmer': True}, 'returns':["rouge1", "rouge2", "rougeL"]}</li>
<li>{'bert_score': { 'returns': ["precision", "recall", "f1"] }</li>
<li>{'bleu': { 'returns': "bleu" }</li>
<li>{'bleurt': { 'returns': "scores" }</li>
<li>{'meteor': { 'returns': "meteor" }</li>
<li>{'sacrebleu': { 'returns': "score" }</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Seq2SeqMetricsCallback" class="doc_header"><code>class</code> <code>Seq2SeqMetricsCallback</code><a href="https://github.com/ohmeow/blurr/tree/master/blurr/modeling/seq2seq/core.py#L42" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Seq2SeqMetricsCallback</code>(<strong><code>custom_metrics</code></strong>:<code>dict</code>=<em><code>None</code></em>, <strong><code>calc_every</code></strong>:<code>str</code>=<em><code>'epoch'</code></em>, <strong><code>ignore_token_id</code></strong>=<em><code>-100</code></em>, <strong><code>text_gen_kwargs</code></strong>:<code>dict</code>=<em><code>{}</code></em>, <strong>**<code>kwargs</code></strong>) :: <code>Callback</code></p>
</blockquote>
<p>A callback that adds seq2seq metrics</p>
<table>
<thead><tr>
<th></th>
<th>Type</th>
<th>Default</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><code>custom_metrics</code></strong></td>
<td><code>dict</code></td>
<td>``</td>
<td>A dictionary of seq2seq metrics we want to use. See below and the various task specific seq2seq docs<br />for examples of how to configure this per task</td>
</tr>
<tr>
<td><strong><code>calc_every</code></strong></td>
<td><code>str</code></td>
<td><code>epoch</code></td>
<td>Calculation of these metrics requires text generation, which is expensive.  You can choose to calculate<br />these metrics on every 'epoch', 'other_epoch', or 'last_epoch' instead (default: 'epoch')</td>
</tr>
<tr>
<td><strong><code>ignore_token_id</code></strong></td>
<td><code>int</code></td>
<td><code>-100</code></td>
<td>The token ID that should be ignored when calculating the loss</td>
</tr>
<tr>
<td><strong><code>text_gen_kwargs</code></strong></td>
<td><code>dict</code></td>
<td>``</td>
<td>Any keyword arguments to pass to the <code>hf_model.generate</code> method</td>
</tr>
<tr>
<td><strong><code>kwargs</code></strong></td>
<td></td>
<td></td>
<td><em>No Content</em></td>
</tr>
</tbody>
</table>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We add a custom param splitter to give us a bit more depth in applying discriminative learning rates for Seq2Seq tasks.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="blurr_seq2seq_splitter" class="doc_header"><code>blurr_seq2seq_splitter</code><a href="https://github.com/ohmeow/blurr/tree/master/blurr/modeling/seq2seq/core.py#L193" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>blurr_seq2seq_splitter</code>(<strong><code>m</code></strong>:<code>PreTrainedModel</code>, <strong><code>arch</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Custom param splitter for summarization models</p>
<table>
<thead><tr>
<th></th>
<th>Type</th>
<th>Default</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><code>m</code></strong></td>
<td><code>PreTrainedModel</code></td>
<td></td>
<td>A Hugging Face model</td>
</tr>
<tr>
<td><strong><code>arch</code></strong></td>
<td><code>str</code></td>
<td></td>
<td>The name of the architecture you are working with (e.g., bart, fsmt, pegasus, etc...)</td>
</tr>
</tbody>
</table>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">seq2seq_metrics</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;rouge&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;compute_kwargs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;rouge_types&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;rouge1&quot;</span><span class="p">,</span> <span class="s2">&quot;rouge2&quot;</span><span class="p">,</span> <span class="s2">&quot;rougeL&quot;</span><span class="p">],</span> <span class="s2">&quot;use_stemmer&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
        <span class="s2">&quot;returns&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;rouge1&quot;</span><span class="p">,</span> <span class="s2">&quot;rouge2&quot;</span><span class="p">,</span> <span class="s2">&quot;rougeL&quot;</span><span class="p">],</span>
    <span class="p">},</span>
    <span class="s2">&quot;bertscore&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;compute_kwargs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;lang&quot;</span><span class="p">:</span> <span class="s2">&quot;en&quot;</span><span class="p">},</span> <span class="s2">&quot;returns&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;precision&quot;</span><span class="p">,</span> <span class="s2">&quot;recall&quot;</span><span class="p">,</span> <span class="s2">&quot;f1&quot;</span><span class="p">]},</span>
    <span class="s2">&quot;bleu&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;returns&quot;</span><span class="p">:</span> <span class="s2">&quot;bleu&quot;</span><span class="p">},</span>
    <span class="s2">&quot;meteor&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;returns&quot;</span><span class="p">:</span> <span class="s2">&quot;meteor&quot;</span><span class="p">},</span>
    <span class="s2">&quot;sacrebleu&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;returns&quot;</span><span class="p">:</span> <span class="s2">&quot;score&quot;</span><span class="p">},</span>
<span class="p">}</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">BaseModelWrapper</span><span class="p">(</span><span class="n">hf_model</span><span class="p">)</span>
<span class="n">learn_cbs</span> <span class="o">=</span> <span class="p">[</span><span class="n">BaseModelCallback</span><span class="p">]</span>
<span class="n">fit_cbs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Seq2SeqMetricsCallback</span><span class="p">(</span><span class="n">custom_metrics</span><span class="o">=</span><span class="n">seq2seq_metrics</span><span class="p">,</span> <span class="n">calc_every</span><span class="o">=</span><span class="s2">&quot;other_epoch&quot;</span><span class="p">)]</span>

<span class="n">learn</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span>
    <span class="n">dls</span><span class="p">,</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">opt_func</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">Adam</span><span class="p">),</span>
    <span class="n">loss_func</span><span class="o">=</span><span class="n">CrossEntropyLossFlat</span><span class="p">(),</span>  <span class="c1"># PreCalculatedLoss()</span>
    <span class="n">cbs</span><span class="o">=</span><span class="n">learn_cbs</span><span class="p">,</span>
    <span class="n">splitter</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">blurr_seq2seq_splitter</span><span class="p">,</span> <span class="n">arch</span><span class="o">=</span><span class="n">hf_arch</span><span class="p">),</span>
<span class="p">)</span>  <span class="c1"># .to_native_fp16() #.to_fp16()</span>

<span class="n">learn</span><span class="o">.</span><span class="n">unfreeze</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>[nltk_data] Downloading package wordnet to /home/wgilliam/nltk_data...
[nltk_data]   Package wordnet is already up-to-date!
[nltk_data] Downloading package punkt to /home/wgilliam/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package omw-1.4 to /home/wgilliam/nltk_data...
[nltk_data]   Package omw-1.4 is already up-to-date!
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">dls</span><span class="o">.</span><span class="n">one_batch</span><span class="p">()</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="nb">len</span><span class="p">(</span><span class="n">preds</span><span class="p">),</span> <span class="n">preds</span><span class="p">[</span><span class="s2">&quot;loss&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">preds</span><span class="p">[</span><span class="s2">&quot;logits&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(4, torch.Size([]), torch.Size([2, 74, 50264]))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">dls</span><span class="o">.</span><span class="n">one_batch</span><span class="p">()</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="nb">len</span><span class="p">(</span><span class="n">preds</span><span class="p">),</span> <span class="n">preds</span><span class="p">[</span><span class="s2">&quot;loss&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">preds</span><span class="p">[</span><span class="s2">&quot;logits&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(4, torch.Size([]), torch.Size([2, 69, 50264]))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">learn</span><span class="o">.</span><span class="n">opt</span><span class="o">.</span><span class="n">param_groups</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>3
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">lr_find</span><span class="p">(</span><span class="n">suggest_funcs</span><span class="o">=</span><span class="p">[</span><span class="n">minimum</span><span class="p">,</span> <span class="n">steep</span><span class="p">,</span> <span class="n">valley</span><span class="p">,</span> <span class="n">slide</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "></div>

</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>SuggestedLRs(minimum=5.754399462603033e-05, steep=2.2908675418875646e-06, valley=3.630780702224001e-05, slide=6.309573450380412e-07)</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">lr_max</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mf">9e-7</span><span class="p">,</span> <span class="mf">9e-5</span><span class="p">),</span> <span class="n">cbs</span><span class="o">=</span><span class="n">fit_cbs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>rouge1</th>
      <th>rouge2</th>
      <th>rougeL</th>
      <th>bertscore_precision</th>
      <th>bertscore_recall</th>
      <th>bertscore_f1</th>
      <th>bleu</th>
      <th>meteor</th>
      <th>sacrebleu</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.944016</td>
      <td>1.922908</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>02:00</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1.164089</td>
      <td>1.869277</td>
      <td>0.396318</td>
      <td>0.171549</td>
      <td>0.266486</td>
      <td>0.880081</td>
      <td>0.894858</td>
      <td>0.887346</td>
      <td>0.149207</td>
      <td>0.374644</td>
      <td>12.130262</td>
      <td>03:59</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.395553</td>
      <td>2.174400</td>
      <td>0.393733</td>
      <td>0.165318</td>
      <td>0.261367</td>
      <td>0.880042</td>
      <td>0.892583</td>
      <td>0.886198</td>
      <td>0.148458</td>
      <td>0.364950</td>
      <td>12.042490</td>
      <td>03:45</td>
    </tr>
  </tbody>
</table></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Showing-results">Showing results<a class="anchor-link" href="#Showing-results"> </a></h3><p>Below we'll add in additional functionality to take advantage of Hugging Face's <code>PreTrainedModel.generate</code> model, which can be used to easily implement beam search, top-k/nucleous sampling, etc... so that we get more human sounding results.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_article</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">About 10 men armed with pistols and small machine guns raided a casino in Switzerland and made off </span>
<span class="s2">into France with several hundred thousand Swiss francs in the early hours of Sunday morning, police said. </span>
<span class="s2">The men, dressed in black clothes and black ski masks, split into two groups during the raid on the Grand Casino </span>
<span class="s2">Basel, Chief Inspector Peter Gill told CNN. One group tried to break into the casino&#39;s vault on the lower level </span>
<span class="s2">but could not get in, but they did rob the cashier of the money that was not secured, he said. The second group </span>
<span class="s2">of armed robbers entered the upper level where the roulette and blackjack tables are located and robbed the </span>
<span class="s2">cashier there, he said. As the thieves were leaving the casino, a woman driving by and unaware of what was </span>
<span class="s2">occurring unknowingly blocked the armed robbers&#39; vehicles. A gunman pulled the woman from her vehicle, beat </span>
<span class="s2">her, and took off for the French border. The other gunmen followed into France, which is only about 100 </span>
<span class="s2">meters (yards) from the casino, Gill said. There were about 600 people in the casino at the time of the robbery. </span>
<span class="s2">There were no serious injuries, although one guest on the Casino floor was kicked in the head by one of the </span>
<span class="s2">robbers when he moved, the police officer said. Swiss authorities are working closely with French authorities, </span>
<span class="s2">Gill said. The robbers spoke French and drove vehicles with French lRicense plates. CNN&#39;s Andreena Narayan </span>
<span class="s2">contributed to this report.</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">blurr_predict</span><span class="p">(</span><span class="n">test_article</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">hf_tokenizer</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][:</span><span class="mi">20</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;s&gt;&lt;s&gt;        Gun 10 men armed with pistols and machine machine guns raided a casino. Switzerland. made
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>That doesn't look much like a human-generated text.  Let's use Hugging Face's <code>PreTrainedModel.generate</code> method to create something more human-like.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">dls</span><span class="o">.</span><span class="n">valid</span><span class="o">.</span><span class="n">one_batch</span><span class="p">()</span>

<span class="n">tfm</span> <span class="o">=</span> <span class="n">first_blurr_tfm</span><span class="p">(</span><span class="n">dls</span><span class="p">)</span>

<span class="n">b_hf_tokenizer</span> <span class="o">=</span> <span class="n">tfm</span><span class="o">.</span><span class="n">hf_tokenizer</span>
<span class="n">b_ignore_token_id</span> <span class="o">=</span> <span class="n">tfm</span><span class="o">.</span><span class="n">ignore_token_id</span>

<span class="n">test_input_ids</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;input_ids&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">learn</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">hf_model</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<span class="n">test_trg_ids</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">learn</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">hf_model</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<span class="n">test_trg_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">trg</span><span class="p">[</span><span class="n">trg</span> <span class="o">!=</span> <span class="n">b_ignore_token_id</span><span class="p">]</span> <span class="k">for</span> <span class="n">trg</span> <span class="ow">in</span> <span class="n">test_trg_ids</span><span class="p">]</span>

<span class="n">gen_text</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">hf_model</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">test_input_ids</span><span class="p">,</span> <span class="n">num_beams</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">130</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Target ===&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">b_hf_tokenizer</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">test_trg_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">skip_special_tokens</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">clean_up_tokenization_spaces</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Prediction ===&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">b_hf_tokenizer</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">gen_text</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">skip_special_tokens</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">clean_up_tokenization_spaces</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>=== Target ===
 Hotel guests who &#34;go green&#34; are happier with their stay.
Increasing water and energy costs are pushing hotels to cut costs wherever they can.
Many hotels find that guests don&#39;t mind using the same towels and sheets every night.
TripAdvisor will be adding a green label for hotels listed on its site.

=== Prediction ===
 Hotels often try to make guests &#34;green&#34; while promoting &#34;environmental conscious&#34; behavior.
But even the most environmental guests may not want to treat themselves to fresh towels or shampoo.
Dan Condon, a recycling enthusiast, doesn&#39;t like hotel towels, even though he works in an environment-conscious industry.
Condon: &#34;I could care less about rewards for environmentally conscious behavior unless it&#39;s miles&#34;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To make things even easier, for text generation tasks you can simply call the <code>Learn.blurr_generate</code> method, optionally passing in whatever text generation kwargs you wish, to accomplish the same as above.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">outputs</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">blurr_generate</span><span class="p">(</span><span class="n">test_article</span><span class="p">,</span> <span class="n">num_return_sequences</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">outputs</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== Prediction </span><span class="si">{</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> ===</span><span class="se">\n</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>=== Prediction 1 ===
 10 men armed with pistols and machine guns raided a casino in Switzerland .
They made off with several hundred thousand Swiss francs in the early hours of Sunday morning, police said .
One woman was beaten by the robbers after unknowingly blocking their vehicles with her car .
There were no serious injuries, although one man was kicked in the head by one of the robbers .

=== Prediction 2 ===
 10 men armed with pistols and machine guns raided a casino in Switzerland .
They made off with several hundred thousand Swiss francs in the early hours of Sunday morning, police said .
One woman was beaten by the robbers after unknowingly blocking their vehicles with her car .
The robbers spoke French and drove vehicles with French lRicense plates .

=== Prediction 3 ===
 10 men armed with pistols and machine guns raided a casino in Switzerland .
They made off with several hundred thousand Swiss francs in the early hours of Sunday morning .
One woman was beaten by the robbers after unknowingly blocking their vehicles with her car .
The robbers spoke French and drove vehicles with French lRicense plates .

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Much nicer!!! Now, we can update our @typedispatched <code>show_results</code> to use this new method.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">show_results</span><span class="p">(</span><span class="n">learner</span><span class="o">=</span><span class="n">learn</span><span class="p">,</span> <span class="n">input_trunc_at</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">target_trunc_at</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "></div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea "><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>target</th>
      <th>prediction</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Dan Condon believes in recycling. Just not when it comes to his hotel towels. Condon composts when he's at home in Boulder, Colorado. He eats local, organic and fair-trade food and drives a Honda CR-Z hybrid sports car. You might call him green. Except he's not so green when he travels for his work at an education nonprofit and stays in a hotel, which happens about 10 weeks per year. There, he uses a new towel every day. And don't try to bribe him with a drink or dessert coupon to get him to re</td>
      <td>Hotel guests who "go green" are happier with their stay.\nIncreasing water and energy costs are pushing hotels to cut costs wherever they can.\nMany hotels find that guests don't mind using the same towels and sheets every night.\nTripAdvisor will be a</td>
      <td>Hotels often try to make guests "green" while promoting "environmental conscious" behavior .\nBut even the most environmental guests may not want to treat themselves to fresh towels or shampoo .\nDan Condon, a recycling enthusiast, doesn't like hotel</td>
    </tr>
    <tr>
      <th>1</th>
      <td>(CNN) -- Wondering where to go for your next holiday? Experts explain which destinations we should be checking out in 2014. Brazil: The World Cup. The modern game of football, or soccer, may have been born in England's public schools, but many will claim its soul has settled in Brazil. It has the world's most successful international team, winning the World Cup five times. It calls what many claim to be the world's greatest player, Pele, one of its own. And company managers and bosses are known</td>
      <td>New Zealand government threw $50 million into the construction of the Nga Haerenga cycle trails.\nNosara in Costa Rica recently awarded a Blue Flag -- a certification awarded to world's best beaches.\nFirst few months of 2014 best period for Northern</td>
      <td>World Cup 2014 will take place in Brazil next year .\nThe country has the world's most successful international team, winning the World Cup five times .\nThere are plenty of reasons to visit some of the country's more remote areas .\nTake a boat tour t</td>
    </tr>
  </tbody>
</table></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Inference">Inference<a class="anchor-link" href="#Inference"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">export_fname</span> <span class="o">=</span> <span class="s2">&quot;summarize_export&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">learn</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">export_fname</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">inf_learn</span> <span class="o">=</span> <span class="n">load_learner</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">export_fname</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">)</span>
<span class="n">inf_learn</span><span class="o">.</span><span class="n">blurr_generate</span><span class="p">(</span><span class="n">test_article</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39; 10 men armed with pistols and machine guns raided a casino in Switzerland .\nThey made off with several hundred thousand Swiss francs in the early hours of Sunday morning, police said .\nOne woman was beaten by the robbers after unknowingly blocking their vehicles with her car .\nThere were no serious injuries, although one man was kicked in the head by one of the robbers .&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Summary">Summary<a class="anchor-link" href="#Summary"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This module includes the fundamental bits to all Seq2Seq transformers training and inference.</p>

</div>
</div>
</div>
</div>
 

